<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNS Zone Tool</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>DNS Zone Tool</h1>
            <button id="logoutBtn" class="btn btn-secondary">Logout</button>
        </header>

        <nav class="tabs">
            <button class="tab-btn active" data-tab="zones">DNS Zone</button>
            <button class="tab-btn" data-tab="config">API Token Configuration</button>
            <button class="tab-btn" data-tab="security">Security</button>
            <button class="tab-btn" data-tab="audit-logs">Audit Logs</button>
            <button class="tab-btn" data-tab="peer-sync">Peer Sync</button>
        </nav>

        <!-- DNS Zone Tab -->
        <div id="zonesTab" class="tab-content active">
            <div class="zones-header">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">DNS Zones</h2>
                    <button id="refreshZonesBtn" class="btn btn-primary" onclick="refreshZones()">Refresh Zones</button>
                </div>
                <div class="public-ip-display">
                    <div class="ip-info-group">
                        <label class="ip-label">Public IP:</label>
                        <span id="publicIpDisplay" class="ip-value">Loading...</span>
                    </div>
                    <div class="intervals-section">
                        <h3 class="intervals-heading">Interval</h3>
                        <div class="intervals-container">
                            <div class="ip-info-group">
                                <label class="ip-interval-label">Public IP Query:</label>
                                <select id="publicIpInterval" class="ip-interval-select" onchange="savePublicIPInterval()" style="width: 150px; padding: 6px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.9em;"></select>
                            </div>
                            <div class="ip-info-group">
                                <label class="ip-interval-label">Monitor IP Status Check:</label>
                                <select id="localIpStatusInterval" class="ip-interval-select" onchange="saveLocalIPStatusInterval()" style="width: 150px; padding: 6px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.9em;"></select>
                            </div>
                            <div class="ip-info-group">
                                <label class="ip-interval-label">Automatic Update Check:</label>
                                <select id="autoUpdateInterval" class="ip-interval-select" onchange="saveAutoUpdateInterval()" style="width: 150px; padding: 6px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.9em;"></select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="zonesList"></div>
        </div>

        <!-- Configuration Tab -->
        <div id="configTab" class="tab-content">
            <h2>API Token Configuration</h2>
            <p style="color: #666; font-size: 0.9em; margin-bottom: 20px; padding: 15px; background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 4px;">
                <strong>‚ö†Ô∏è Important:</strong> API tokens must be manually configured on each peer. API token keys are not synchronized between peers for security reasons.
            </p>
            
            <!-- Machine Name Section -->
            <div class="config-section" style="border: 1px solid #ddd; padding: 20px; margin-top: 20px; border-radius: 4px;">
                <h3>Machine Name</h3>
                <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">The machine name is used in email notifications to identify the server (e.g. "my server").</p>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="text" id="machineNameInput" placeholder="e.g. my server" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; max-width: 300px;">
                    <button id="saveMachineNameBtn" class="btn btn-primary" onclick="saveMachineName()">Save</button>
                </div>
            </div>
            
            <!-- Saved Tokens Display -->
            <div id="savedTokens" class="saved-tokens-section"></div>
            
            <!-- Add New Token Section -->
            <div class="config-section" style="border: 2px dashed #ddd; padding: 20px; margin-top: 20px;">
                <h3>Add New API Token</h3>
                <div style="margin-bottom: 10px;">
                    <label style="display: block; margin-bottom: 5px;">Token Name:</label>
                    <input type="text" id="newTokenNameInput" placeholder="e.g. Production Token" style="width: 100%; padding: 8px; margin-bottom: 10px;">
                </div>
                <div style="margin-bottom: 10px;">
                    <label style="display: block; margin-bottom: 5px;">API Token:</label>
                    <input type="password" id="newTokenInput" placeholder="Enter Hetzner DNS API token" style="width: 100%; padding: 8px; margin-bottom: 10px;">
                </div>
                <button id="addTokenBtn" class="btn btn-primary">Add Token</button>
            </div>
            
        </div>

        <!-- Security Tab -->
        <div id="securityTab" class="tab-content">
            <h2>Security Configuration</h2>
            
            <!-- Password Change Section -->
            <div class="config-section" style="border: 1px solid #ddd; padding: 20px; margin-top: 20px; border-radius: 4px;">
                <h3>Change Password</h3>
                <div style="margin-bottom: 10px;">
                    <label style="display: block; margin-bottom: 5px;">Current Password:</label>
                    <input type="password" id="currentPasswordInput" placeholder="Enter current password" style="width: 100%; padding: 8px; margin-bottom: 10px;">
                </div>
                <div style="margin-bottom: 10px;">
                    <label style="display: block; margin-bottom: 5px;">New Password:</label>
                    <input type="password" id="newPasswordInput" placeholder="Enter new password (min. 12 chars, with number, uppercase, special char)" minlength="12" style="width: 100%; padding: 8px; margin-bottom: 10px;">
                </div>
                <button id="changePasswordBtn" class="btn btn-primary">Change Password</button>
            </div>
            
            <!-- 2FA Section -->
            <div class="config-section" style="border: 1px solid #ddd; padding: 20px; margin-top: 20px; border-radius: 4px;">
                <h3>Two-Factor Authentication (2FA)</h3>
                <div id="2faStatus" style="margin-bottom: 15px;">
                    <p>Status: <span id="2faStatusText">Loading...</span></p>
                </div>
                <div id="2faSetupSection" style="display: none;">
                    <div style="margin-bottom: 10px;">
                        <label style="display: block; margin-bottom: 5px;">Password (to verify):</label>
                        <input type="password" id="2faPasswordInput" placeholder="Enter your password" style="width: 100%; padding: 8px; margin-bottom: 10px;">
                    </div>
                    <button id="setup2faBtn" class="btn btn-primary">Setup 2FA</button>
                </div>
                <div id="2faVerifySection" style="display: none;">
                    <div style="margin-bottom: 10px;">
                        <p>Scan this QR code with your authenticator app:</p>
                        <img id="2faQRCode" src="" alt="QR Code" style="max-width: 200px; margin-bottom: 10px;">
                    </div>
                    <div style="margin-bottom: 10px;">
                        <label style="display: block; margin-bottom: 5px;">Enter 2FA token to verify:</label>
                        <input type="text" id="2faTokenInput" placeholder="Enter 6-digit code" style="width: 100%; padding: 8px; margin-bottom: 10px;">
                    </div>
                    <button id="verify2faBtn" class="btn btn-primary">Verify & Enable 2FA</button>
                </div>
                <div id="2faBackupCodesSection" style="display: none; border: 1px solid #ddd; padding: 15px; margin-top: 15px; border-radius: 4px; background: #f9f9f9;">
                    <h4 style="margin-top: 0;">Backup Codes</h4>
                    <div id="backupCodesStatus" style="margin-bottom: 15px;">
                        <p>Status: <span id="backupCodesStatusText">Loading...</span></p>
                    </div>
                    <p style="color: #666; font-size: 0.9em; margin-bottom: 10px;">Backup codes can be used instead of your 2FA token if you lose access to your authenticator app. Generate new codes as needed.</p>
                    <button id="generateBackupCodesBtn" class="btn btn-primary">Generate Backup Codes</button>
                </div>
                <div id="2faDisableSection" style="display: none;">
                    <div style="margin-bottom: 10px;">
                        <label style="display: block; margin-bottom: 5px;">Password (to disable 2FA):</label>
                        <input type="password" id="2faDisablePasswordInput" placeholder="Enter your password" style="width: 100%; padding: 8px; margin-bottom: 10px;">
                    </div>
                    <button id="disable2faBtn" class="btn btn-secondary">Disable 2FA</button>
                </div>
            </div>
            
            <!-- Brute-Force Protection Section -->
            <div class="config-section" style="border: 1px solid #ddd; padding: 20px; margin-top: 20px; border-radius: 4px;">
                <h3>Brute-Force Protection</h3>
                <div style="margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="bruteForceEnabled" onchange="toggleBruteForce()">
                        <span>Enable Brute-Force Protection</span>
                    </label>
                </div>
                <div id="bruteForceSettings" style="display: none;">
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">Max Login Attempts:</label>
                        <input type="number" id="maxLoginAttempts" min="1" max="20" value="5" style="width: 100px; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                        <small style="color: #666; margin-left: 10px;">Number of failed login attempts before lockout</small>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">Max 2FA Attempts:</label>
                        <input type="number" id="max2FAAttempts" min="1" max="10" value="3" style="width: 100px; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                        <small style="color: #666; margin-left: 10px;">Number of failed 2FA attempts before lockout</small>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">Login Lockout Duration (minutes):</label>
                        <input type="number" id="loginLockoutDuration" min="1" max="1440" value="15" style="width: 100px; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                        <small style="color: #666; margin-left: 10px;">Lockout duration after max login attempts</small>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">2FA Lockout Duration (minutes):</label>
                        <input type="number" id="2faLockoutDuration" min="1" max="1440" value="5" style="width: 100px; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                        <small style="color: #666; margin-left: 10px;">Lockout duration after max 2FA attempts</small>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">Time Window (minutes):</label>
                        <input type="number" id="timeWindow" min="1" max="1440" value="10" style="width: 100px; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                        <small style="color: #666; margin-left: 10px;">Time window for counting failed attempts</small>
                    </div>
                    <button id="saveBruteForceBtn" class="btn btn-primary" onclick="saveBruteForceSettings()">Save Settings</button>
                </div>
            </div>
            
            <!-- IP Access Control Section -->
            <div class="config-section" style="border: 1px solid #ddd; padding: 20px; margin-top: 20px; border-radius: 4px;">
                <h3>IP Access Control</h3>
                
                <!-- Whitelist -->
                <div style="margin-bottom: 20px;">
                    <h4>IP Whitelist</h4>
                    <div style="margin-bottom: 10px;">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="whitelistEnabled" onchange="toggleWhitelist()">
                            <span>Enable IP Whitelist</span>
                        </label>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <input type="text" id="whitelistIpInput" placeholder="IP or CIDR (e.g. 192.168.1.1 or 192.168.1.0/24)" style="width: 70%; padding: 8px; margin-right: 10px;">
                        <button id="addWhitelistIpBtn" class="btn btn-primary" onclick="addWhitelistIp()">Add IP</button>
                    </div>
                    <div id="whitelistIpsList" style="margin-top: 10px;"></div>
                </div>
                
                <!-- Blacklist -->
                <div style="margin-bottom: 20px;">
                    <h4>IP Blacklist</h4>
                    <div style="margin-bottom: 10px;">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="blacklistEnabled" onchange="toggleBlacklist()">
                            <span>Enable IP Blacklist</span>
                        </label>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <input type="text" id="blacklistIpInput" placeholder="IP or CIDR (e.g. 192.168.1.1 or 192.168.1.0/24)" style="width: 70%; padding: 8px; margin-right: 10px;">
                        <button id="addBlacklistIpBtn" class="btn btn-primary" onclick="addBlacklistIp()">Add IP</button>
                    </div>
                    <div id="blacklistIpsList" style="margin-top: 10px;"></div>
                </div>
            </div>

            <!-- Trusted Proxy IPs Section -->
            <div class="config-section" style="border: 1px solid #ddd; padding: 20px; margin-top: 20px; border-radius: 4px;">
                <h3>Trusted Reverse Proxies</h3>
                <p style="color: #666; font-size: 0.9em; margin-bottom: 10px;">
                    These IPs/CIDRs are allowed to set <code>X-Forwarded-For</code>. Add your HAProxy IP here (e.g. <code>192.168.123.10/32</code>).
                </p>
                <textarea id="trustedProxyIpsInput" rows="4" placeholder="One per line (IP or CIDR)\n192.168.123.10/32\n10.0.0.0/24" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;"></textarea>
                <div style="margin-top: 10px; display: flex; gap: 10px; align-items: center;">
                    <button id="saveTrustedProxyIpsBtn" class="btn btn-primary" onclick="saveTrustedProxyIps()">Save Trusted Proxies</button>
                    <button id="reloadTrustedProxyIpsBtn" class="btn btn-secondary" onclick="loadTrustedProxyIps()">Reload</button>
                </div>
                <div id="trustedProxyIpsStatus" style="margin-top: 10px; color: #666; font-size: 0.9em;"></div>
            </div>
            
            <!-- SMTP Email Notifications Section -->
            <div class="config-section" style="border: 1px solid #ddd; padding: 20px; margin-top: 20px; border-radius: 4px;">
                <h3>E-Mail Benachrichtigungen (SMTP)</h3>
                <div style="margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="smtpEnabled" onchange="toggleSMTP()">
                        <span>E-Mail-Benachrichtigungen aktivieren</span>
                    </label>
                </div>
                <div id="smtpSettings" style="display: none;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">SMTP Host:</label>
                            <input type="text" id="smtpHost" placeholder="smtp.example.com" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Port:</label>
                            <input type="number" id="smtpPort" value="587" min="1" max="65535" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Benutzer:</label>
                            <input type="text" id="smtpUser" placeholder="smtp@example.com" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Password:</label>
                            <input type="password" id="smtpPassword" placeholder="Password (leave empty to keep current)" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="smtpUseTLS" checked>
                            <span>TLS verwenden</span>
                        </label>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">From-Adresse:</label>
                            <input type="email" id="smtpFrom" placeholder="noreply@example.com" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">To-Adresse:</label>
                            <input type="email" id="smtpTo" placeholder="admin@example.com" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: bold;">Events f√ºr E-Mail-Benachrichtigungen ausw√§hlen:</label>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; max-height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: 4px;">
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" class="smtp-event-checkbox" value="login_success">
                                <span>Login Success</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" class="smtp-event-checkbox" value="login_failure">
                                <span>Login Failure</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" class="smtp-event-checkbox" value="logout">
                                <span>Logout</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" class="smtp-event-checkbox" value="password_change">
                                <span>Password Change</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" class="smtp-event-checkbox" value="2fa_setup">
                                <span>2FA Setup</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" class="smtp-event-checkbox" value="2fa_disable">
                                <span>2FA Disable</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" class="smtp-event-checkbox" value="2fa_verify_failure">
                                <span>2FA Verify Failure</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" class="smtp-event-checkbox" value="token_add">
                                <span>Token Add</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" class="smtp-event-checkbox" value="token_delete">
                                <span>Token Delete</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" class="smtp-event-checkbox" value="zone_create">
                                <span>Zone Create</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" class="smtp-event-checkbox" value="zone_delete">
                                <span>Zone Delete</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" class="smtp-event-checkbox" value="record_create">
                                <span>Record Create</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" class="smtp-event-checkbox" value="record_update">
                                <span>Record Update</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" class="smtp-event-checkbox" value="record_delete">
                                <span>Record Delete</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" class="smtp-event-checkbox" value="ip_update">
                                <span>IP Update</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" class="smtp-event-checkbox" value="ip_whitelist_add">
                                <span>IP Whitelist Add</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" class="smtp-event-checkbox" value="ip_blacklist_add">
                                <span>IP Blacklist Add</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" class="smtp-event-checkbox" value="monitor_ip_offline">
                                <span>Monitor IP Offline</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" class="smtp-event-checkbox" value="monitor_ip_online">
                                <span>Monitor IP Online</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" class="smtp-event-checkbox" value="monitor_ip_status_check">
                                <span>Monitor IP Status Check</span>
                            </label>
                        </div>
                    </div>
                    
                    <button id="saveSMTPBtn" class="btn btn-primary" onclick="saveSMTPConfig()">SMTP-Konfiguration speichern</button>
                </div>
            </div>
        </div>

        <!-- Audit Logs Tab -->
        <div id="audit-logsTab" class="tab-content">
            <h2>Audit Logs</h2>
            
            <!-- Log Rotation Settings Section -->
            <div class="config-section" style="border: 1px solid #ddd; padding: 20px; margin-top: 20px; border-radius: 4px;">
                <h3>Log Rotation Settings</h3>
                <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">Configure automatic log file rotation to manage disk space.</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Max File Size (MB):</label>
                        <input type="number" id="auditLogMaxSizeMB" min="1" max="1000" step="1" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <small style="color: #666; font-size: 0.85em;">Maximum size before rotation (default: 10 MB)</small>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Max Age (Days):</label>
                        <input type="number" id="auditLogMaxAgeDays" min="1" max="365" step="1" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <small style="color: #666; font-size: 0.85em;">Maximum age before rotation (default: 30 days)</small>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Rotation Check Interval (Hours):</label>
                        <input type="number" id="auditLogRotationIntervalHours" min="1" max="168" step="1" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <small style="color: #666; font-size: 0.85em;">How often to check for rotation (default: 24 hours)</small>
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button id="saveAuditLogSettingsBtn" class="btn btn-primary" onclick="saveAuditLogSettings()">Save Settings</button>
                    <button id="loadAuditLogSettingsBtn" class="btn btn-secondary" onclick="loadAuditLogSettings()">Reload</button>
                </div>
            </div>
            
            <!-- Filters Section -->
            <div class="config-section" style="border: 1px solid #ddd; padding: 20px; margin-top: 20px; border-radius: 4px;">
                <h3>Filters</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Action Type:</label>
                        <select id="auditLogActionFilter" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="">All Actions</option>
                            <option value="login_success">Login Success</option>
                            <option value="login_failure">Login Failure</option>
                            <option value="logout">Logout</option>
                            <option value="password_change">Password Change</option>
                            <option value="2fa_setup">2FA Setup</option>
                            <option value="2fa_disable">2FA Disable</option>
                            <option value="2fa_verify_success">2FA Verify Success</option>
                            <option value="2fa_verify_failure">2FA Verify Failure</option>
                            <option value="ip_whitelist_add">IP Whitelist Add</option>
                            <option value="ip_whitelist_remove">IP Whitelist Remove</option>
                            <option value="ip_whitelist_toggle">IP Whitelist Toggle</option>
                            <option value="ip_blacklist_add">IP Blacklist Add</option>
                            <option value="ip_blacklist_remove">IP Blacklist Remove</option>
                            <option value="ip_blacklist_toggle">IP Blacklist Toggle</option>
                            <option value="token_add">Token Add</option>
                            <option value="token_delete">Token Delete</option>
                            <option value="token_update">Token Update</option>
                            <option value="zone_create">Zone Create</option>
                            <option value="zone_delete">Zone Delete</option>
                            <option value="record_create">Record Create</option>
                            <option value="record_update">Record Update</option>
                            <option value="record_delete">Record Delete</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Username:</label>
                        <input type="text" id="auditLogUsernameFilter" placeholder="Filter by username" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Start Date:</label>
                        <input type="datetime-local" id="auditLogStartDateFilter" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">End Date:</label>
                        <input type="datetime-local" id="auditLogEndDateFilter" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Limit:</label>
                        <input type="number" id="auditLogLimitFilter" value="100" min="10" max="1000" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button id="applyAuditLogFiltersBtn" class="btn btn-primary" onclick="loadAuditLogs()">Apply Filters</button>
                    <button id="clearAuditLogFiltersBtn" class="btn btn-secondary" onclick="clearAuditLogFilters()">Clear Filters</button>
                    <button id="refreshAuditLogsBtn" class="btn btn-primary" onclick="loadAuditLogs()">Refresh</button>
                </div>
        </div>

            <!-- Logs Display Section -->
            <div class="config-section" style="border: 1px solid #ddd; padding: 20px; margin-top: 20px; border-radius: 4px;">
                <h3>Log Entries</h3>
                <div id="auditLogsDisplay" style="margin-top: 15px;">
                    <p style="color: #666;">Loading logs...</p>
                </div>
            </div>
        </div>

        <!-- Peer Sync Tab -->
        <div id="peer-syncTab" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">Peer Sync Configuration</h2>
                <button class="btn btn-primary" onclick="pullNewestConfigWithConfirmation()" style="font-size: 0.95em; padding: 10px 20px;">
                    üîÑ Pull Newest Config
                </button>
            </div>
            
            <!-- Sync Settings -->
            <div class="config-section" style="border: 1px solid #ddd; padding: 20px; margin-top: 20px; border-radius: 4px;">
                <h3>Sync Settings</h3>
            <div style="margin-bottom: 15px;">
                <label style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="peerSyncEnabled" onchange="savePeerSyncConfig()">
                    <span style="font-weight: bold;">Enable Peer-Sync</span>
                </label>
                <p style="margin: 5px 0 0 25px; color: #666; font-size: 0.85em;">
                    When enabled, configuration changes are automatically synchronized to all peers on every change.
                </p>
            </div>
            <div style="margin-bottom: 15px; padding: 10px; background-color: #e3f2fd; border-radius: 4px;">
                <p style="margin: 0; color: #1976d2; font-size: 0.9em;">
                    <strong>‚ÑπÔ∏è Info:</strong> When Peer-Sync is enabled, configuration changes are automatically synchronized to all peers on every change.
                </p>
            </div>
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Request Timeout (seconds):</label>
                <input type="number" id="peerSyncTimeout" min="1" max="30" step="0.1" value="3" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; max-width: 300px;">
            </div>
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">NTP Server:</label>
                <input type="text" id="peerSyncNtpServer" placeholder="pool.ntp.org" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; max-width: 300px;">
            </div>
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Timezone:</label>
                <select id="peerSyncTimezone" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; max-width: 300px;">
                    <optgroup label="UTC">
                        <option value="UTC">UTC (Coordinated Universal Time)</option>
                    </optgroup>
                    <optgroup label="Europa">
                        <option value="Europe/Berlin">Europe/Berlin (CET/CEST)</option>
                        <option value="Europe/London">Europe/London (GMT/BST)</option>
                        <option value="Europe/Paris">Europe/Paris (CET/CEST)</option>
                        <option value="Europe/Madrid">Europe/Madrid (CET/CEST)</option>
                        <option value="Europe/Rome">Europe/Rome (CET/CEST)</option>
                        <option value="Europe/Amsterdam">Europe/Amsterdam (CET/CEST)</option>
                        <option value="Europe/Vienna">Europe/Vienna (CET/CEST)</option>
                        <option value="Europe/Zurich">Europe/Zurich (CET/CEST)</option>
                        <option value="Europe/Stockholm">Europe/Stockholm (CET/CEST)</option>
                        <option value="Europe/Warsaw">Europe/Warsaw (CET/CEST)</option>
                        <option value="Europe/Prague">Europe/Prague (CET/CEST)</option>
                        <option value="Europe/Brussels">Europe/Brussels (CET/CEST)</option>
                        <option value="Europe/Copenhagen">Europe/Copenhagen (CET/CEST)</option>
                        <option value="Europe/Helsinki">Europe/Helsinki (EET/EEST)</option>
                        <option value="Europe/Oslo">Europe/Oslo (CET/CEST)</option>
                        <option value="Europe/Dublin">Europe/Dublin (GMT/IST)</option>
                        <option value="Europe/Lisbon">Europe/Lisbon (WET/WEST)</option>
                        <option value="Europe/Athens">Europe/Athens (EET/EEST)</option>
                        <option value="Europe/Bucharest">Europe/Bucharest (EET/EEST)</option>
                        <option value="Europe/Budapest">Europe/Budapest (CET/CEST)</option>
                        <option value="Europe/Moscow">Europe/Moscow (MSK)</option>
                        <option value="Europe/Kiev">Europe/Kiev (EET/EEST)</option>
                        <option value="Europe/Istanbul">Europe/Istanbul (TRT)</option>
                    </optgroup>
                    <optgroup label="Nordamerika">
                        <option value="America/New_York">America/New_York (EST/EDT)</option>
                        <option value="America/Chicago">America/Chicago (CST/CDT)</option>
                        <option value="America/Denver">America/Denver (MST/MDT)</option>
                        <option value="America/Los_Angeles">America/Los_Angeles (PST/PDT)</option>
                        <option value="America/Toronto">America/Toronto (EST/EDT)</option>
                        <option value="America/Vancouver">America/Vancouver (PST/PDT)</option>
                        <option value="America/Mexico_City">America/Mexico_City (CST/CDT)</option>
                        <option value="America/Chicago">America/Chicago (CST/CDT)</option>
                        <option value="America/Phoenix">America/Phoenix (MST)</option>
                        <option value="America/Anchorage">America/Anchorage (AKST/AKDT)</option>
                        <option value="America/Honolulu">America/Honolulu (HST)</option>
                    </optgroup>
                    <optgroup label="S√ºdamerika">
                        <option value="America/Sao_Paulo">America/Sao_Paulo (BRT/BRST)</option>
                        <option value="America/Buenos_Aires">America/Buenos_Aires (ART)</option>
                        <option value="America/Lima">America/Lima (PET)</option>
                        <option value="America/Santiago">America/Santiago (CLT/CLST)</option>
                    </optgroup>
                    <optgroup label="Asien">
                        <option value="Asia/Tokyo">Asia/Tokyo (JST)</option>
                        <option value="Asia/Shanghai">Asia/Shanghai (CST)</option>
                        <option value="Asia/Hong_Kong">Asia/Hong_Kong (HKT)</option>
                        <option value="Asia/Singapore">Asia/Singapore (SGT)</option>
                        <option value="Asia/Seoul">Asia/Seoul (KST)</option>
                        <option value="Asia/Taipei">Asia/Taipei (CST)</option>
                        <option value="Asia/Bangkok">Asia/Bangkok (ICT)</option>
                        <option value="Asia/Jakarta">Asia/Jakarta (WIB)</option>
                        <option value="Asia/Manila">Asia/Manila (PHT)</option>
                        <option value="Asia/Kolkata">Asia/Kolkata (IST)</option>
                        <option value="Asia/Dubai">Asia/Dubai (GST)</option>
                        <option value="Asia/Riyadh">Asia/Riyadh (AST)</option>
                        <option value="Asia/Jerusalem">Asia/Jerusalem (IST/IDT)</option>
                        <option value="Asia/Doha">Asia/Doha (AST)</option>
                        <option value="Asia/Kuwait">Asia/Kuwait (AST)</option>
                        <option value="Asia/Mumbai">Asia/Mumbai (IST)</option>
                        <option value="Asia/Dhaka">Asia/Dhaka (BST)</option>
                    </optgroup>
                    <optgroup label="Ozeanien">
                        <option value="Australia/Sydney">Australia/Sydney (AEDT/AEST)</option>
                        <option value="Australia/Melbourne">Australia/Melbourne (AEDT/AEST)</option>
                        <option value="Australia/Brisbane">Australia/Brisbane (AEST)</option>
                        <option value="Australia/Perth">Australia/Perth (AWST)</option>
                        <option value="Australia/Adelaide">Australia/Adelaide (ACDT/ACST)</option>
                        <option value="Australia/Darwin">Australia/Darwin (ACST)</option>
                        <option value="Pacific/Auckland">Pacific/Auckland (NZDT/NZST)</option>
                        <option value="Pacific/Honolulu">Pacific/Honolulu (HST)</option>
                    </optgroup>
                    <optgroup label="Afrika">
                        <option value="Africa/Cairo">Africa/Cairo (EET)</option>
                        <option value="Africa/Johannesburg">Africa/Johannesburg (SAST)</option>
                        <option value="Africa/Lagos">Africa/Lagos (WAT)</option>
                        <option value="Africa/Casablanca">Africa/Casablanca (WET/WEST)</option>
                        <option value="Africa/Nairobi">Africa/Nairobi (EAT)</option>
                    </optgroup>
                </select>
                <div id="currentServerTime" style="margin-top: 10px; padding: 8px; background-color: #f0f0f0; border-radius: 4px; font-family: monospace; font-size: 0.9em;">
                    <span style="color: #666;">Current Server Time: </span>
                    <span id="currentTimeDisplay" style="color: #333; font-weight: bold;">Loading...</span>
                </div>
            </div>
            <button class="btn btn-primary" onclick="savePeerSyncConfig()">Save Settings</button>
            </div>

            <!-- Own Public Key Section -->
            <div class="config-section" style="border: 1px solid #ddd; padding: 20px; margin-top: 20px; border-radius: 4px;">
                <h3>Own Public Key</h3>
                <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">This public key must be configured on other peers. It is used for authentication and encryption (via ECDH). The public key can be shared insecurely.</p>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Public Key:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="peerPublicKey" readonly style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace; font-size: 0.85em;">
                        <button class="btn btn-secondary" onclick="copyToClipboard('peerPublicKey')">Copy</button>
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 15px; background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; display: flex; align-items: center; justify-content: space-between; gap: 15px;">
                    <p style="margin: 0; color: #856404; font-size: 0.9em; flex: 1;">
                        <strong>‚ö†Ô∏è Important:</strong> If you regenerate the private key, you must update the new public key on all other peers!
                    </p>
                    <button class="btn btn-warning" onclick="regeneratePeerKey()" style="white-space: nowrap; flex-shrink: 0;">Generate New Private Key</button>
                </div>
            </div>

            <!-- Peer Nodes & Keys Configuration -->
            <div class="config-section" style="border: 1px solid #ddd; padding: 20px; margin-top: 20px; border-radius: 4px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div>
                        <h3 style="margin: 0;">Peer Nodes & Keys</h3>
                        <p style="color: #666; font-size: 0.9em; margin: 5px 0 0 0;">Configure peer nodes and their 32-byte keys (Base64). Supported formats: IP:Port, http://IP:Port, https://domain:Port, domain:Port</p>
                    </div>
                    <div style="text-align: right;">
                        <div style="color: #666; font-size: 0.85em; margin-bottom: 3px;">Local Config Last Modified:</div>
                        <div id="localConfigLastModified" style="font-weight: bold; color: #333; font-size: 0.9em;">Loading...</div>
                    </div>
                </div>
                
                <!-- Peer Nodes Table -->
                <div style="margin-bottom: 15px; overflow-x: auto;">
                    <table id="peerNodesTable" style="width: auto; border-collapse: collapse; table-layout: auto; font-size: 0.9em; font-family: inherit;">
                        <thead>
                            <tr style="background-color: #f5f5f5;">
                                <th style="padding: 10px; text-align: left; border: 1px solid #ddd; white-space: nowrap; font-size: 0.9em; font-family: inherit;">Peer Address</th>
                                <th style="padding: 10px; text-align: left; border: 1px solid #ddd; white-space: nowrap; font-size: 0.9em; font-family: inherit;">Peer Name</th>
                                <th style="padding: 10px; text-align: left; border: 1px solid #ddd; white-space: nowrap; font-size: 0.9em; font-family: inherit;">Public IP</th>
                                <th style="padding: 10px; text-align: left; border: 1px solid #ddd; font-size: 0.9em; font-family: monospace; min-width: 200px;">Public Key</th>
                                <th style="padding: 10px; text-align: left; border: 1px solid #ddd; white-space: nowrap; font-size: 0.9em; font-family: inherit;">Status</th>
                                <th style="padding: 10px; text-align: left; border: 1px solid #ddd; white-space: nowrap; font-size: 0.9em; font-family: inherit;">Config Last Modified</th>
                                <th style="padding: 10px; text-align: left; border: 1px solid #ddd; white-space: nowrap; font-size: 0.9em; font-family: inherit;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="peerNodesTableBody">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Add New Peer -->
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <input type="text" id="newPeerNodeInput" placeholder="e.g. 192.168.1.100:8412, https://peer.example.com:443" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; max-width: 400px;">
                    <button class="btn btn-primary" onclick="addPeerNode()">Add Peer</button>
                </div>
            </div>

        </div>

    </div>

    <div id="toast" class="toast"></div>

    <script src="/static/js/app.js"></script>
    <script src="/static/js/auth.js"></script>
</body>
</html>

